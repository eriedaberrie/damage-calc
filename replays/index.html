<html>
  <body>
    <script>
      (async () => {
        const response = await fetch('https://api.github.com/repos/eriedaberrie/damage-calc/contents/replays/');
        let data = await response.json();
        let compileddata = {};
        for (let file of data) {
          if (!file.name.endsWith('.html') || file.name === 'index.html') continue;
          let splitdata = file.name.split("-")
          if (!compileddata[splitdata[0]]) compileddata[splitdata[0]] = [];
          compileddata[splitdata[0]].push({
            file: file.name,
            players: [splitdata[4], splitdata[5].slice(0, -5)],
            date: `${splitdata[1]}-${splitdata[2]}-${splitdata[3]}`
          });
        }
        
        htmlString = ''
        let formatnum = 0;
        for (let format in compileddata) {
          htmlString += format + '<ul>';
          for (let replay of compileddata[format].sort((a, b) => {return (a.date < b.date) ? 1 : -1})) {
            htmlString += `<li><a href="${replay.file}">${replay.players[0]} vs ${replay.players[1]}&nbsp;&nbsp;${replay.date}</a></li>`;
          }
          htmlString += '</ul>';
        }
        
        document.getElementsByTagName('body')[0].innerHTML = htmlString;
      })()
    </script>
  <body>
</html>